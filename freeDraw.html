<!DOCTYPE html>
<html>
    <head>
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <link rel="stylesheet" href="styles.css">
    </head>
    <body>
        <h1>Draw Something!</h1>
        <div class="buttons">
            <select id="color">
                <option value="black" selected="selected">Black</option>
                <option value="red">Red</option>
                <option value="blue">Blue</option>
                <option value="green">Green</option>
            </select>
            <select id="width">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5" selected="selected">5</option>
                <option value="6">6</option>
                <option value="7">7</option>
                <option value="8">8</option>
                <option value="9">9</option>
                <option value="10">10</option>
            </select>
            <input id="erase" value="Erase all" type="submit">
            <hr>
        </div>
        <svg id="svg" style="width:100%; height: 800px"></svg>
    </body>
    <script>

        // Select the canvas and set drawing boolean logic
        const svg = d3.select('#svg');
        let drawing = false;
        let color = document.querySelector("#color").value;
        let width = document.querySelector("#width").value;
        let pointArray = [];

        // Color variable
        document.querySelector("#color").onchange = () => {
            color = document.querySelector("#color").value;   
        }

        // Width variable
        document.querySelector("#width").onchange = () => {
            width = document.querySelector("#width").value;   
        }

        // Drawing logic
        function draw_point() {
            if (!drawing)
                return;
            
            const coords = d3.mouse(this); 

            svg.append('circle')
               .attr('cx', coords[0])
               .attr('cy', coords[1])
               .attr('r', width)
               .style('fill', color);

            if (pointArray.length > 1) {
                
                lastPoint = pointArray.pop();
                console.log("[Last point: " + lastPoint);
                console.log("Current point: " + coords + "]");

                svg.append("line")
                    .attr("x1", lastPoint[0])
                    .attr("y1", lastPoint[1])
                    .attr("x2", coords[0])
                    .attr("y2", coords[1])
                    .style("stroke-width", String(Number(width) * 2))
                    .style("stroke", color);
            }

            pointArray.push(coords);
        };

        // Detect mouse states
        svg.on('mousedown', () => {
            drawing = true;
        });
        svg.on('mouseup', () => {
            drawing = false;
            pointArray = [];
        });
        svg.on('mousemove', draw_point);

        // If erase button is pressed, erase everything
        document.querySelector("#erase").onclick = () => {
            d3.select("#svg").selectAll("*").remove();
        }

    </script>
</html>
